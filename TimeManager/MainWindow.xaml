<Window x:Class="TimeManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Time Manager 24h" Height="600" Width="1000"
        WindowStartupLocation="CenterScreen"
        xmlns:v="clr-namespace:TimeManager.View"
        ResizeMode="NoResize">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>
    <Window.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#2E2E2E" Offset="0.0"/>
            <GradientStop Color="#1A1A1A" Offset="1.0"/>
        </LinearGradientBrush>
    </Window.Background>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.45*"/>
            <ColumnDefinition Width="0.55*"/>
        </Grid.ColumnDefinitions>

        <GroupBox Header="List of Procesess" Foreground="White" BorderBrush="#444" Margin="0,0,10,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Button Content="+" Command="{Binding ShowFormCommand}" 
                Background="#444" Foreground="White" Margin="5"/>

                <StackPanel Grid.Row="1" Margin="5" 
                    Visibility="{Binding IsFormVisible, Converter={StaticResource BoolToVis}}">

                    <TextBox Text="{Binding NewTitle, UpdateSourceTrigger=PropertyChanged}" 
                     Tag="Название..." Margin="2"/>
                    <TextBox Text="{Binding NewStart, UpdateSourceTrigger=PropertyChanged}" 
                     Tag="Начало (14:00)" Margin="2"/>
                    <TextBox Text="{Binding NewEnd, UpdateSourceTrigger=PropertyChanged}" 
                     Tag="Конец (15:30)" Margin="2"/>
                    <TextBox Text="{Binding NewColor, UpdateSourceTrigger=PropertyChanged}" 
                     Tag="Цвет (#FF0000)" Margin="2"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="Colors:" Foreground="White" VerticalAlignment="Center" Margin="0,0,10,0"/>

                        <ItemsControl ItemsSource="{Binding PresetColors}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Command="{Binding DataContext.SelectColorCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                        CommandParameter="{Binding}"
                        Width="20" Height="20" Margin="2" Cursor="Hand">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Ellipse Fill="{Binding}" Stroke="White" StrokeThickness="1"/>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>

                    <Button Content="Save" Command="{Binding AddTaskCommand}" 
                    Background="Green" Foreground="White" Margin="5"/>
                    
                </StackPanel>

                <ListBox Grid.Row="2" ItemsSource="{Binding Slots}" 
         Background="Transparent" BorderThickness="0"
         HorizontalContentAlignment="Stretch">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="10,5" CornerRadius="12" BorderBrush="Silver" BorderThickness="1">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#3A3A3A" Offset="0"/>
                                        <GradientStop Color="#252525" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>

                                <Grid Height="60" Margin="15,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="50"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>

                                    <Ellipse Grid.Column="0" Width="18" Height="18" 
                             Fill="{Binding ColorHex}" 
                             HorizontalAlignment="Left" VerticalAlignment="Center"/>

                                    <TextBlock Grid.Column="1" Text="{Binding ProcessName}" 
                               Foreground="White" FontWeight="SemiBold" FontSize="15"
                               VerticalAlignment="Center" HorizontalAlignment="Center" 
                               TextTrimming="CharacterEllipsis"/>

                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding StartTime}" Foreground="White" FontSize="12" HorizontalAlignment="Right"/>
                                        <TextBlock Text="{Binding EndTime}" Foreground="Silver" FontSize="11" HorizontalAlignment="Right"/>
                                    </StackPanel>

                                    <Button Grid.Column="3" Content="✕" 
                            Command="{Binding DataContext.DeleteTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            CommandParameter="{Binding}"
                            Background="Transparent" Foreground="#FF4444" BorderThickness="0"
                            FontSize="16" Cursor="Hand" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </GroupBox>
        
        <Grid Grid.Column="1" x:Name="ClockContainer">
            <v:ClockControl x:Name="ClockControl" />
        </Grid>
    </Grid>
</Window>